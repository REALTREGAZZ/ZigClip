<!DOCTYPE html>
<html>
<head>
    <title>ZIGCLIP Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .test-section { margin: 20px 0; padding: 15px; background: white; border-radius: 5px; }
        button { padding: 10px 15px; margin: 5px; }
        #test-results { margin-top: 20px; padding: 15px; background: #e0e0e0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ZIGCLIP PWA Test</h1>
    
    <div class="test-section">
        <h2>Storage Test</h2>
        <button id="test-storage">Test Storage Initialization</button>
        <button id="test-elo">Test ELO Calculation</button>
        <button id="test-ranking">Test Ranking Generation</button>
    </div>
    
    <div class="test-section">
        <h2>Video Test</h2>
        <video id="test-video" width="300" controls></video>
        <button id="test-video-load">Test Video Loading</button>
    </div>
    
    <div class="test-section">
        <h2>Animation Test</h2>
        <canvas id="test-particles" width="300" height="200" style="border: 1px solid black;"></canvas>
        <button id="test-particles">Test Particles</button>
        <div id="test-flash" style="width: 100px; height: 100px; background: lightgray; margin: 10px 0;"></div>
        <button id="test-flash-anim">Test Flash Animation</button>
    </div>
    
    <div id="test-results"></div>
    
    <script src="js/storage.js"></script>
    <script src="js/elo.js"></script>
    <script src="js/ranking.js"></script>
    <script src="js/animations.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const results = document.getElementById('test-results');
            
            function logResult(message, isError = false) {
                const p = document.createElement('p');
                p.textContent = message;
                p.style.color = isError ? 'red' : 'green';
                results.appendChild(p);
                console.log(message);
            }
            
            // Test storage
            document.getElementById('test-storage').addEventListener('click', () => {
                try {
                    StorageService.initializeIfNeeded();
                    const clips = StorageService.loadClips();
                    const profile = StorageService.loadProfile();
                    logResult(`Storage initialized. Found ${clips.length} clips and 1 profile.`);
                } catch (e) {
                    logResult(`Storage test failed: ${e.message}`, true);
                }
            });
            
            // Test ELO
            document.getElementById('test-elo').addEventListener('click', () => {
                try {
                    const clip1 = { id: 1, elo: 1500 };
                    const clip2 = { id: 2, elo: 1500 };
                    const result = ELOCalculator.calculateDuel(clip1, clip2);
                    logResult(`ELO test: Winner +${result.winner_delta}, Loser ${result.loser_delta}`);
                } catch (e) {
                    logResult(`ELO test failed: ${e.message}`, true);
                }
            });
            
            // Test ranking
            document.getElementById('test-ranking').addEventListener('click', () => {
                try {
                    const top100 = RankingService.generateTop100();
                    logResult(`Generated top 100 ranking with ${top100.length} players.`);
                } catch (e) {
                    logResult(`Ranking test failed: ${e.message}`, true);
                }
            });
            
            // Test video loading
            document.getElementById('test-video-load').addEventListener('click', () => {
                const video = document.getElementById('test-video');
                video.src = 'assets/videos/clip_1.mp4';
                video.load();
                logResult('Video loading started...');
            });
            
            // Test particles
            document.getElementById('test-particles').addEventListener('click', () => {
                const canvas = document.getElementById('test-particles');
                const particleSystem = new ParticleSystem(canvas);
                particleSystem.emit(canvas.width / 2, canvas.height / 2);
                logResult('Particles emitted!');
            });
            
            // Test flash animation
            document.getElementById('test-flash-anim').addEventListener('click', () => {
                const flashElement = document.getElementById('test-flash');
                Animations.flashNeon(flashElement, '#00FFD0', 3);
                logResult('Flash animation triggered!');
            });
        });
    </script>
</body>
</html>