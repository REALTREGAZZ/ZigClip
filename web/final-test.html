<!DOCTYPE html>
<html>
<head>
    <title>ZIGCLIP Final Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .test-section { margin: 20px 0; padding: 15px; background: white; border-radius: 5px; }
        button { padding: 10px 15px; margin: 5px; }
        #test-results { margin-top: 20px; padding: 15px; background: #e0e0e0; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>ZIGCLIP Final Integration Test</h1>
    
    <div class="test-section">
        <h2>Core Functionality Tests</h2>
        <button id="test-all">Run All Tests</button>
        <button id="clear-results">Clear Results</button>
    </div>
    
    <div id="test-results"></div>
    
    <script src="js/storage.js"></script>
    <script src="js/elo.js"></script>
    <script src="js/ranking.js"></script>
    <script src="js/animations.js"></script>
    <script src="js/qrcode.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const results = document.getElementById('test-results');
            
            function logResult(message, isError = false) {
                const p = document.createElement('p');
                p.textContent = message;
                p.className = isError ? 'error' : 'success';
                results.appendChild(p);
                console.log(message);
            }
            
            function clearResults() {
                results.innerHTML = '';
            }
            
            function runAllTests() {
                clearResults();
                logResult('Starting ZIGCLIP integration tests...');
                
                try {
                    // Test 1: Storage initialization
                    logResult('Test 1: Storage initialization');
                    StorageService.initializeIfNeeded();
                    const clips = StorageService.loadClips();
                    const profile = StorageService.loadProfile();
                    logResult(`✓ Storage initialized with ${clips.length} clips and 1 user profile`);
                    
                    // Test 2: ELO calculation
                    logResult('Test 2: ELO calculation');
                    const testUser = { id: 'test', elo: 1500 };
                    const testOpponent = { id: 1, elo: 1500 };
                    const eloResult = ELOCalculator.calculateDuel(testUser, testOpponent);
                    logResult(`✓ ELO calculation works: +${eloResult.winner_delta} for winner`);
                    
                    // Test 3: Ranking generation
                    logResult('Test 3: Ranking generation');
                    const top100 = RankingService.generateTop100();
                    logResult(`✓ Generated top 100 ranking with ${top100.length} players`);
                    
                    // Test 4: Badge calculation
                    logResult('Test 4: Badge calculation');
                    const badge = ELOCalculator.getBadge(profile.elo, 100);
                    logResult(`✓ Badge calculation works: ${badge.name} (${badge.color})`);
                    
                    // Test 5: QR code generation
                    logResult('Test 5: QR code generation');
                    const qrCanvas = QRCode.generate('test-data', 100);
                    logResult(`✓ QR code generated: ${qrCanvas.width}x${qrCanvas.height}`);
                    
                    // Test 6: Particle system
                    logResult('Test 6: Particle system');
                    const testCanvas = document.createElement('canvas');
                    const particleSystem = new ParticleSystem(testCanvas);
                    logResult(`✓ Particle system initialized`);
                    
                    // Test 7: Animation functions
                    logResult('Test 7: Animation functions');
                    const testDiv = document.createElement('div');
                    testDiv.style.width = '100px';
                    testDiv.style.height = '100px';
                    testDiv.style.background = 'lightgray';
                    document.body.appendChild(testDiv);
                    Animations.flashNeon(testDiv, '#00FFD0', 1);
                    logResult(`✓ Animation functions work`);
                    setTimeout(() => {
                        document.body.removeChild(testDiv);
                    }, 1000);
                    
                    logResult('✅ All tests completed successfully!');
                    logResult('ZIGCLIP PWA is ready for deployment.');
                    
                } catch (e) {
                    logResult(`❌ Test failed: ${e.message}`, true);
                    logResult(`Stack: ${e.stack}`, true);
                }
            }
            
            document.getElementById('test-all').addEventListener('click', runAllTests);
            document.getElementById('clear-results').addEventListener('click', clearResults);
            
            // Run tests automatically on load
            setTimeout(runAllTests, 1000);
        });
    </script>
</body>
</html>